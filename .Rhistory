filter(.lower >=0) %>%
arrange(-condition_mean)
l %>%
spread_draws(b[term,group]) %>%
filter(term == "libido") %>%
mutate(group = str_remove(group, "itemID:")) %>%
median_qi(condition_mean = b, .width = c(.4)) %>%
filter(.lower >=0) %>%
arrange(-condition_mean)
library(tidyverse)
df_ratings <- read_csv("data/new_df_full.csv")
df_users <- read_csv("data/users.csv") %>%
mutate(focus = if_else(is.na(focus), for_focus, focus),
cognition = if_else(is.na(cognition), for_cognition, cognition),
mood = if_else(is.na(mood), for_mood, mood),
anxiety = if_else(is.na(anxiety), for_anxiety, anxiety),
motivation = if_else(is.na(motivation), for_motivation, motivation)) %>%
select(-for_focus, -for_anxiety, -for_motivation, -for_cognition, -for_mood)
df_metadata <- read_delim("data/nootropics_metadata.csv", delim=";")
df <-  df_ratings %>%
left_join(df_users %>% mutate(userID = as.numeric(userID)), by = c("userID"))
users_filling_issues <- (df %>%
group_by(userID) %>%
filter(n() > 15) %>%  #enough ratings
ungroup() %>%
filter(issue != "None / Unsure") %>%  #at least one not None
select(userID) %>%
distinct)$userID
df %>%
filter(userID %in% users_filling_issues) %>%
group_by(itemID, issue) %>%
summarise(count = n()) %>%
mutate(prop = 100 * count / sum(count)) %>%
filter(str_detect(issue, "addiction")) %>%
arrange(prop)
df %>%
filter(userID %in% users_filling_issues) %>%
group_by(itemID) %>%
mutate(count_item = n()) %>%
group_by(itemID, issue) %>%
summarise(count = n()) %>%
mutate(prop = 100 * count / sum(count)) %>%
filter(str_detect(issue, "addiction")) %>%
arrange(prop)
df %>%
filter(userID %in% users_filling_issues) %>%
group_by(itemID, issue) %>%
summarise(count = n()) %>%
mutate(prop = 100 * count / sum(count)) %>%
pivot_wider(names_from = "issue", values_from = "prop") %>%
#filter(str_detect(issue, "addiction")) %>%
arrange(prop)
df %>%
filter(userID %in% users_filling_issues) %>%
group_by(itemID, issue) %>%
summarise(count = n()) %>%
mutate(prop = 100 * count / sum(count)) %>%
pivot_wider(names_from = "issue", values_from = "prop")
df %>%
filter(userID %in% users_filling_issues) %>%
group_by(itemID, issue) %>%
summarise(count = n()) %>%
mutate(prop = 100 * count / sum(count)) %>%
pivot_wider(names_from = "issue", values_from = "prop") %>%
#filter(str_detect(issue, "addiction")) %>%
arrange("Developed addiction")
View(df %>%
filter(userID %in% users_filling_issues) %>%
group_by(itemID, issue) %>%
summarise(count = n()) %>%
mutate(prop = 100 * count / sum(count)) %>%
pivot_wider(names_from = "issue", values_from = "prop") %>%
#filter(str_detect(issue, "addiction")) %>%
arrange("Developed addiction"))
df %>%
filter(userID %in% users_filling_issues) %>%
group_by(itemID, issue) %>%
summarise(count = n()) %>%
mutate(prop = 100 * count / sum(count))
df %>%
filter(userID %in% users_filling_issues) %>%
group_by(itemID, issue) %>%
summarise(count = n()) %>%
mutate(prop = 100 * count / sum(count)) %>%
pivot_wider(names_from = "issue", values_from = "prop")
df %>%
filter(userID %in% users_filling_issues) %>%
group_by(itemID, issue) %>%
summarise(count = n()) %>%
mutate(prop = 100 * count / sum(count)) %>%
select(-count) %>%
pivot_wider(names_from = "issue", values_from = "prop")
View(df %>%
filter(userID %in% users_filling_issues) %>%
group_by(itemID, issue) %>%
summarise(count = n()) %>%
mutate(prop = 100 * count / sum(count)) %>%
select(-count) %>%
pivot_wider(names_from = "issue", values_from = "prop") %>%
#filter(str_detect(issue, "addiction")) %>%
arrange("Developed addiction"))
f %>%
filter(userID %in% users_filling_issues) %>%
group_by(itemID, issue) %>%
summarise(count = n()) %>%
mutate(prop = 100 * count / sum(count))
df %>%
filter(userID %in% users_filling_issues) %>%
group_by(itemID, issue) %>%
summarise(count = n()) %>%
mutate(prop = 100 * count / sum(count))
library(tidyverse)
df_ratings <- read_csv("data/new_df.csv")
df_ratings %>%
group_by(userID) %>%
summarise(count = n())
df_ratings %>%
group_by(userID) %>%
summarise(count = n()) %>%
ggplot() +
geom_histogram()
df_ratings %>%
group_by(userID) %>%
summarise(count = n()) %>%
ggplot() +
geom_histogram(aes(x = count))
df_ratings %>%
mutate(date = as_date(time))
library(lubridate)
df_ratings %>%
mutate(date = as_date(time))
View(df_ratings)
df_ratings <- read_csv("data/new_df_full.csv")
df_ratings %>%
mutate(date = as_date(time))
library(tidyverse)
library(lubridate)
df_ratings <- read_csv("data/new_df_full.csv")
df_ratings
df_ratings %>%
mutate(date = as_date(time))
df_ratings %>%
mutate(date = as_datetime(time))
df_ratings %>%
mutate(date = as_datetime(time)) %>%
mutate(new_design = (year(date) == 2022))
df_ratings %>%
mutate(date = as_datetime(time)) %>%
mutate(new_design = (year(date) == 2022)) %>%
group_by(userID, new_design) %>%
summarise(count = n()) %>%
ggplot() +
geom_histogram(aes(x = count, fill=new_design))
df_ratings %>%
mutate(date = as_datetime(time)) %>%
mutate(new_design = (year(date) == 2022)) %>%
group_by(userID, new_design) %>%
summarise(count = n()) %>%
df_ratings %>%
mutate(date = as_datetime(time)) %>%
mutate(new_design = (year(date) == 2022)) %>%
group_by(userID, new_design) %>%
summarise(count = n())
df_ratings %>%
mutate(date = as_datetime(time)) %>%
mutate(new_design = (year(date) == 2022)) %>%
group_by(new_design, userID) %>%
summarise(count = n()) %>%
summarise(m = mean(count), s = sd(count))
df_ratings %>%
mutate(date = as_datetime(time)) %>%
#mutate(new_design = (year(date) == 2022)) %>%
mutate(new_design = (date > now())) %>%
group_by(userID, new_design) %>%
summarise(count = n()) %>%
ggplot() +
geom_histogram(aes(x = count, fill=new_design))
df_ratings %>%
mutate(date = as_datetime(time)) %>%
#mutate(new_design = (year(date) == 2022)) %>%
mutate(new_design = (date > now() - 12)) %>%
group_by(userID, new_design) %>%
summarise(count = n()) %>%
ggplot() +
geom_histogram(aes(x = count, fill=new_design))
now()
now() - 12
now() - 12 * 3600
df_ratings %>%
mutate(date = as_datetime(time)) %>%
#mutate(new_design = (year(date) == 2022)) %>%
mutate(new_design = (date > now() - 15 * 3600)) %>%
group_by(userID, new_design) %>%
summarise(count = n()) %>%
ggplot() +
geom_histogram(aes(x = count, fill=new_design))
df_ratings %>%
mutate(date = as_datetime(time)) %>%
#mutate(new_design = (year(date) == 2022)) %>%
mutate(new_design = (date > now() - 5 * 3600)) %>%
group_by(userID, new_design) %>%
summarise(count = n()) %>%
ggplot() +
geom_histogram(aes(x = count, fill=new_design))
df_ratings %>%
mutate(date = as_datetime(time)) %>%
mutate(new_design = (year(date) == 2022)) %>%
#mutate(new_design = (date > now() - 5 * 3600)) %>%
group_by(userID, new_design) %>%
summarise(count = n()) %>%
ggplot() +
geom_histogram(aes(x = count, fill=new_design))
df_ratings %>%
mutate(date = as_datetime(time)) %>%
mutate(new_design = (year(date) == 2022)) %>%
group_by(new_design, userID) %>%
summarise(count = n()) %>%
summarise(m = mean(count), s = sd(count))
df_positions <- read_csv("data/positions.csv")
df_positions
View(df_positions)
df_positions <- read_csv("data/positions.csv")
df_positions
df_positions %>%
group_by(session_id) %>%
summarise(start_time = min(time), end_time = max(time))
df_positions %>%
group_by(session_id) %>%
summarise(duration =max(time) - min(time))
df_positions %>%
mutate(date = as_datetime(time))
df_positions %>%
mutate(date = as_datetime(time)) %>%
ggplot() +
geom_histogram(aes(x = date))
df_positions %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
filter(duration < 1000) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
filter(duration < 1000, duration > 10) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
filter(userID != "16421609")
df_positions
df_positions %>%
filter(userID != "16421609") %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
filter(duration < 1000, duration > 10) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
filter(userID != "16421609") %>%
group_by(userID) %>%
summarise(duration = max(time) - min(time)) %>%
filter(duration < 1000, duration > 10) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
filter(userID != "16421609") %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
filter(duration < 1000, duration > 10) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
filter(userID != "16421609") %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
filter(userID != "16421609") %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
#filter(duration < 1000, duration > 10) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
filter(userID != "16421609") %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
filter(duration < 1000) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
filter(userID != "16421609") %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
filter(duration < 1000, duration > 10) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
filter(userID != "16421609") %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
mutate(short = if_else(duration < 30, T, F)) %>%
group_by(short) %>%
summarise(count = n())
df_positions
df_positions %>%
filter(userID != "16421609") %>%
filter(position == "result") %>%
select(userID) %>%
distinct()
df_positions %>%
filter(userID != "16421609") %>%
filter(position == "result")
df_positions %>%
filter(userID != "16421609") %>%
filter(position == "results") %>%
select(userID) %>%
distinct()
df_positions %>%
filter(userID != "16421609") %>%
select(userID) %>%
distinct()
df_positions %>%
filter(userID != "16421609") %>%
group_by(userID, position) %>%
summarise(count = n())
library(tidyverse)
library(tidyverse)
library(tidyverse)
library(lubridate)
df_ratings <- read_csv("data/new_df_full.csv")
df_ratings %>%
mutate(date = as_datetime(time)) %>%
mutate(new_design = (year(date) == 2022)) %>%
#mutate(new_design = (date > now() - 5 * 3600)) %>%
group_by(userID, new_design) %>%
summarise(count = n()) %>%
ggplot() +
geom_histogram(aes(x = count, fill=new_design))
df_ratings %>%
mutate(date = as_datetime(time)) %>%
mutate(new_design = (year(date) == 2022)) %>%
group_by(new_design, userID) %>%
summarise(count = n()) %>%
summarise(m = mean(count), s = sd(count))
df_positions <- read_csv("data/positions.csv")
df_positions %>%
mutate(date = as_datetime(time)) %>%
ggplot() +
geom_histogram(aes(x = date))
df_positions %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
filter(duration < 1000, duration > 10) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
filter(userID != "16421609") %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
filter(duration < 1000, duration > 10) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
filter(userID != "16421609") %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
mutate(short = if_else(duration < 30, T, F)) %>%
group_by(short) %>%
summarise(count = n())
df_positions %>%
filter(userID != "16421609") %>%
filter(position == "results") %>%
select(userID) %>%
distinct()
df_positions %>%
filter(userID != "16421609") %>%
group_by(userID, position) %>%
summarise(count = n())
df_positions %>%
filter(userID != "16421609") %>%
group_by(session_id, position) %>%
summarise(count = n())
df_positions %>%
filter(userID != "16421609") %>%
expand(session_id, position)
library(tidyr)
df_positions %>%
filter(userID != "16421609") %>%
expand(session_id, position)
df_positions %>%
filter(userID != "16421609") %>%
tidyr::expand(session_id, position)
df_positions
df_positions %>%
filter(userID != "16421609") %>%
tidyr::expand(session_id, position)
df_positions %>%
filter(userID != "16421609") %>%
tidyr::expand(session_id, position) %>%
right_join(df_positions %>%
filter(userID != "16421609"))
df_positions
df_positions %>%
filter(userID != "16421609")
df_positions <- read_csv("data/positions.csv") %>%
filter(userID != "16421609") %>%
df_positions %>%
mutate(date = as_datetime(time)) %>%
ggplot() +
geom_histogram(aes(x = date))
df_positions <- read_csv("data/positions.csv") %>%
filter(userID != "16421609")
df_positions %>%
mutate(date = as_datetime(time)) %>%
ggplot() +
geom_histogram(aes(x = date))
df_positions %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
filter(duration < 1000, duration > 10) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
filter(userID != "16421609") %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
filter(duration < 1000, duration > 10) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
filter(duration < 1000, duration > 10) %>%
ggplot() +
geom_histogram(aes(duration))
df_positions %>%
group_by(session_id) %>%
summarise(duration = max(time) - min(time)) %>%
mutate(short = if_else(duration < 30, T, F)) %>%
group_by(short) %>%
summarise(count = n())
df_positions %>%
filter(position == "results") %>%
select(userID) %>%
distinct()
df_positions %>%
group_by(session_id, position) %>%
summarise(count = n())
df_positions %>%
filter(userID != "16421609") %>%
tidyr::expand(session_id, position) %>%
right_join(df_positions %>%
filter(userID != "16421609"))
df_positions %>%
tidyr::expand(session_id, position) %>%
right_join(df_positions)
df_positions
View(df_positions %>%
tidyr::expand(session_id, position) %>%
right_join(df_positions))
View(df_positions %>%
tidyr::expand(session_id, position) %>%
left_join(df_positions))
View(df_positions %>%
tidyr::expand(session_id, position) %>%
left_join(df_positions %>%
group_by(session_id, position) %>%
summarise(count = n())))
df_positions
df_positions %>%
group_by(session_id, position) %>%
summarise(count = n())
df_positions %>%
tidyr::expand(session_id, position) %>%
left_join(df_positions %>%
group_by(session_id, position) %>%
summarise(count = n()))
df_positions %>%
tidyr::expand(session_id, position) %>%
left_join(df_positions %>%
group_by(session_id, position) %>%
summarise(count = n())) %>%
group_by(position) %>%
summarise(proba = sum(!is.na(count)))
df_positions %>%
tidyr::expand(session_id, position) %>%
left_join(df_positions %>%
group_by(session_id, position) %>%
summarise(count = n()))
df_positions %>%
tidyr::expand(session_id, position) %>%
left_join(df_positions %>%
group_by(session_id, position) %>%
summarise(count = n()))  %>%
group_by(session_id) %>%
summarise(count = n())
df_positions %>%
tidyr::expand(session_id, position) %>%
left_join(df_positions %>%
group_by(session_id, position) %>%
summarise(count = n())) %>%
group_by(position) %>%
summarise(proba = sum(!is.na(count)))
760 / 3371
760 / 1107
